{"idModule":"73","name":"Google","description":"Ce module vous permet de connecter Gladys aux API Google, comme Google calendar par exemple.","slug":"google","createdAt":"2017-01-30 22:58:58","Developer":"Admin","version":"0.1.0","instructionsHTML":"<p>Nécessite Gladys &gt;= 3.4</p>\n<h4>Configuration</h4>\n<ul>\n<li>Visitez <a href=\"https://console.developers.google.com/project\">la console Google Developpers</a></li>\n<li>Cliquez sur <strong>CREATE PROJECT</strong></li>\n<li>Entrez un <em>Project Name</em> (par exemple &quot;Gladys&quot;) , puis cliquez sur <strong>CREATE</strong></li>\n<li>Sur le dashboard, sous <strong>API Google Apps</strong> cliquez sur <strong>Calendar API</strong>, puis cliquez sur <strong>Activer</strong>. Cela donnera accès à votre projet à l'API Google Calendar.</li>\n<li>Ensuite, sélectionnez <em>APIs &amp; auth</em> sur la colonne latéral et cliquez sur l'onglet <em>Credentials</em></li>\n<li>Cliquez sur le bouton <strong>CREATE NEW CLIENT ID</strong> :\n<ul>\n<li><strong>Application Type</strong>: Other</li>\n<li><strong>Name</strong> : Gladys par exemple</li>\n</ul></li>\n<li>\n<p>Copiez coller le &quot;client ID&quot; et le &quot;client secret&quot;</p>\n</li>\n<li>Allez dans Gladys, et installez ce module &quot;Google&quot;</li>\n<li>Allez dans les paramètres de Gladys, et cliquez sur l'onglet &quot;Paramètres&quot;, puis créez 3 paramètres :\n<ul>\n<li><strong>GOOGLE_API_CLIENT_ID</strong> :  Le &quot;client ID&quot; que vous avez gardé de côté</li>\n<li><strong>GOOGLE_API_CLIENT_SECRET</strong> : Le &quot;client secret&quot;</li>\n<li><strong>GOOGLE_API_REDIRECT_URL</strong>: urn:ietf:wg:oauth:2.0:oob</li>\n</ul></li>\n<li>\n<p>Rebooté Gladys</p>\n</li>\n<li>Créez un script dans Gladys avec le code suivant :</li>\n</ul>\n<pre><code class=\"language-javascript\">gladys.modules.google.getRedirectUrl().then(console.log).catch(console.log);</code></pre>\n<ul>\n<li>Ensuite, allez dans les logs de Gladys sur votre Raspberry Pi (Tapez : <code>pm2 logs gladys</code>), vous devriez voir une<br />\nurl commençant par &quot;https://accounts.google.com/o/oauth2/auth?access_type=offline&quot;. </li>\n<li>Copiez coller cette URL dans votre navigateur et connectez à votre compte Google. Cela devrait vous donner un code. Gardez ce code.</li>\n<li>Dans Gladys, retournez sur le dashboard, créez un script avec le code suivant : </li>\n</ul>\n<pre><code class=\"language-javascript\">gladys.modules.google.authenticate('VOTRE CODE', {id: VOTRE_USER_ID_DANS_GLADYS});</code></pre>\n<p>(Pour trouver votre USER_ID dans Gladys, allez dans &quot;Paramètres&quot; =&gt; &quot;Mon compte&quot; dans Gladys)</p>\n<ul>\n<li>Enfin, pour lancer une première synchronisation du module, créez un script avec le code suivant :</li>\n</ul>\n<pre><code class=\"language-javascript\">gladys.modules.google.calendar.sync().then(console.log).catch(console.log);</code></pre>\n<p>Vous devriez voir dans les logs tous les calendriers/évènements synchronisés ! </p>\n<p>Bravo !</p>\n<h4>Utilisation</h4>\n<p>Je vous recommande de synchroniser vos calendriers au moins une fois dans un script pour vérifier que tout marche, et surtout pour créer tous les calendriers dans Gladys. Vous pouvez aussi cliquez sur le bouton &quot;Configuration&quot; du module google pour synchroniser les calendriers.</p>\n<p>Ensuite, je vous conseille de créer une alarme dans Gladys disant &quot;Toutes les 30 minutes&quot; =&gt; synchroniser les calendriers.</p>\n<ul>\n<li>Commencez par créer une alarme dans &quot;Alarmes&quot;. Créez une règle cron suivante : &quot;0 0,30 <em> </em> <em> </em>&quot;.</li>\n<li>Ensuite créez un scénario qui se déclenche sur cette alarme, et mettez comme action &quot;Synchroniser calendrier&quot;</li>\n</ul>\n<p>Si cette action n'existe pas, allez dans &quot;Paramètres&quot; et cliquez sur &quot;Mettre à jour les données Gladys&quot;. </p>","instructionsMarkDown":"Nécessite Gladys >= 3.4\n\n#### Configuration\n\n- Visitez [la console Google Developpers](https://console.developers.google.com/project)\n- Cliquez sur **CREATE PROJECT**\n- Entrez un *Project Name* (par exemple \"Gladys\") , puis cliquez sur **CREATE**\n- Sur le dashboard, sous **API Google Apps** cliquez sur **Calendar API**, puis cliquez sur **Activer**. Cela donnera accès à votre projet à l'API Google Calendar.\n- Ensuite, sélectionnez *APIs & auth* sur la colonne latéral et cliquez sur l'onglet *Credentials*\n- Cliquez sur le bouton **CREATE NEW CLIENT ID** :\n - **Application Type**: Other\n - **Name** : Gladys par exemple\n- Copiez coller le \"client ID\" et le \"client secret\"\n\n- Allez dans Gladys, et installez ce module \"Google\"\n- Allez dans les paramètres de Gladys, et cliquez sur l'onglet \"Paramètres\", puis créez 3 paramètres :\n  - **GOOGLE_API_CLIENT_ID** :  Le \"client ID\" que vous avez gardé de côté\n  - **GOOGLE_API_CLIENT_SECRET** : Le \"client secret\"\n  - **GOOGLE_API_REDIRECT_URL**: urn:ietf:wg:oauth:2.0:oob\n- Rebooté Gladys\n\n- Créez un script dans Gladys avec le code suivant :\n\n```javascript\ngladys.modules.google.getRedirectUrl().then(console.log).catch(console.log);\n```\n\n- Ensuite, allez dans les logs de Gladys sur votre Raspberry Pi (Tapez : `pm2 logs gladys`), vous devriez voir une \nurl commençant par \"https://accounts.google.com/o/oauth2/auth?access_type=offline\". \n- Copiez coller cette URL dans votre navigateur et connectez à votre compte Google. Cela devrait vous donner un code. Gardez ce code.\n- Dans Gladys, retournez sur le dashboard, créez un script avec le code suivant : \n\n```javascript\ngladys.modules.google.authenticate('VOTRE CODE', {id: VOTRE_USER_ID_DANS_GLADYS});\n```\n\n(Pour trouver votre USER_ID dans Gladys, allez dans \"Paramètres\" => \"Mon compte\" dans Gladys)\n\n- Enfin, pour lancer une première synchronisation du module, créez un script avec le code suivant :\n\n```javascript\ngladys.modules.google.calendar.sync().then(console.log).catch(console.log);\n```\n\nVous devriez voir dans les logs tous les calendriers/évènements synchronisés ! \n\nBravo !\n\n#### Utilisation\n\nJe vous recommande de synchroniser vos calendriers au moins une fois dans un script pour vérifier que tout marche, et surtout pour créer tous les calendriers dans Gladys. Vous pouvez aussi cliquez sur le bouton \"Configuration\" du module google pour synchroniser les calendriers.\n\nEnsuite, je vous conseille de créer une alarme dans Gladys disant \"Toutes les 30 minutes\" => synchroniser les calendriers.\n\n- Commencez par créer une alarme dans \"Alarmes\". Créez une règle cron suivante : \"0 0,30 * * * *\".\n- Ensuite créez un scénario qui se déclenche sur cette alarme, et mettez comme action \"Synchroniser calendrier\"\n\nSi cette action n'existe pas, allez dans \"Paramètres\" et cliquez sur \"Mettre à jour les données Gladys\". ","link":"https://github.com/gladysassistant/gladys-google","img":"bd93f14a-9e97-4e46-aed5-3bfeeea153d6.jpg","note":null,"nbNotes":"0"}